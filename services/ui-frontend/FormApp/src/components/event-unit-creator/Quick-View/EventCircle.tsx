import React, {useEffect, useRef, useState, useContext} from "react"
import {EventData} from "../../EventObject"
import Tail from "./Tail"
interface EventCircleProps{
    EventName: string,
    EventTime: string,
    Data: EventData,
    HasTail: Boolean
}

const EventCircle: React.FC<EventCircleProps> = (
    {EventName, EventTime, Data, HasTail}
    ) =>{
    const AttendeeCirRef = useRef(null)
    const DescriptionCirRef = useRef(null)
    const LocationCirRef = useRef(null)
    const ContactCirRef = useRef(null)
    
    const [data, changeData] = useState(Data)
    const [window, toggleWindow] = useState({active: false, data: {header: "", text:""}})

    const CircleListener = (e:any) =>{
        if(LocationCirRef.current.contains(e.target)){
            toggleWindow({...window, data: {header: "", text: ""}})
            toggleWindow({active: true, data: {header: "Location", text: data.Location}})
        }
        else if(DescriptionCirRef.current.contains(e.target)){
            toggleWindow({...window, data: {header: "", text: ""}})
            toggleWindow({active: true, data: {header: "Description", text: data.Description}})
        }
        else if(ContactCirRef.current.contains(e.target)){
            toggleWindow({...window, data: {header: "", text: ""}})
            toggleWindow({active: true, data: {header: "Contact", text: data.Contact}})
        }
        else if(AttendeeCirRef.current.contains(e.target)){
            toggleWindow({...window, data: {header: "", text: ""}})
            toggleWindow({active: true, data: {header: "Attendee", text: data.Attendees}})
        }
        else{
            toggleWindow({active:false, data:{header: "", text:""}})
        }
    } 

    useEffect(() =>{
        changeData(Data)
    })

    useEffect(() =>{
        document.addEventListener("mousedown", CircleListener)
        return ()=>{
            document.removeEventListener("mousedown", CircleListener)
        }
    }, [data])

    let toggledWindow
    if(window.active){
        toggledWindow = <div className="description-active">
                            <h3>{window.data.header}</h3>
                            <span>{window.data.text}</span>
                        </div>
    }

    return(
        <div>
            <div className="EventCircle-Container">
                <div className="EventCirlce-NameTime">
                    <span>{EventName} - {EventTime}</span>
                </div>
                <svg className="EventCircle-SVG-Container" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" viewBox="0 0 222.11 79.89">
                    <defs>
                        <linearGradient id="linear-gradient" x1="33.24" y1="-275.33" x2="188.87" y2="-150.96" gradientTransform="matrix(1, 0, 0, -1, 0, -173.2)" gradientUnits="userSpaceOnUse">
                            <stop offset="0.19" stopColor="#c0b6ed"/>
                            <stop offset="0.35" stopColor="#cfc5ed"/>
                            <stop offset="0.55" stopColor="#ddd2ee"/>
                            <stop offset="0.74" stopColor="#e1d6ee"/>
                        </linearGradient>
                    </defs>
                    <g id="Layer_2" data-name="Layer 2">
                        <g id="Layer_1-2" data-name="Layer 1">
                            <g>
                                <path style= {{fill:'url(#linear-gradient)'}} className="cls-1" d="M25.36,79.39c-6.59,0-12.91-3.28-17.58-9.11a35.5,35.5,0,0,1-7.28-22V31.61a35.5,35.5,0,0,1,7.28-22C12.45,3.78,18.77.5,25.36.5H196.75a20.51,20.51,0,0,1,9.51,2.37,25.23,25.23,0,0,1,8.07,6.74,32.5,32.5,0,0,1,5.39,10.1,38,38,0,0,1,1.89,11.9V48.28a38,38,0,0,1-1.89,11.9,32.5,32.5,0,0,1-5.39,10.1A25.23,25.23,0,0,1,206.26,77a20.63,20.63,0,0,1-9.51,2.37Zm8-71.11c-6.83,0-13.38,3.39-18.21,9.44A36.7,36.7,0,0,0,7.6,40.5a36.7,36.7,0,0,0,7.55,22.78c4.83,6,11.38,9.44,18.21,9.44h155.4c6.83,0,13.38-3.39,18.21-9.44a36.7,36.7,0,0,0,7.54-22.78A36.7,36.7,0,0,0,207,17.72c-4.83-6-11.38-9.44-18.21-9.44Z"/>
                                <path d="M196.692 1.11111C203.166 1.12287 209.372 4.34588 213.949 10.0736C218.527 15.8013 221.103 23.5664 221.112 31.6667V48.3333C221.103 56.4336 218.527 64.1987 213.949 69.9264C209.372 75.6541 203.166 78.8771 196.692 78.8889H25.308C18.8343 78.8771 12.6284 75.6541 8.05083 69.9264C3.47323 64.1987 0.897396 56.4336 0.888 48.3333V31.6667C0.897396 23.5664 3.47323 15.8013 8.05083 10.0736C12.6284 4.34588 18.8343 1.12287 25.308 1.11111H196.692ZM33.3 73.3333H188.7C195.648 73.3333 202.311 69.88 207.223 63.7329C212.136 57.5859 214.896 49.2488 214.896 40.5556C214.896 31.8623 212.136 23.5252 207.223 17.3782C202.311 11.2311 195.648 7.77778 188.7 7.77778H33.3C26.3524 7.77778 19.6893 11.2311 14.7766 17.3782C9.86393 23.5252 7.104 31.8623 7.104 40.5556C7.104 49.2488 9.86393 57.5859 14.7766 63.7329C19.6893 69.88 26.3524 73.3333 33.3 73.3333V73.3333ZM196.692 0H25.308C18.5959 0 12.1587 3.3363 7.41254 9.27495C2.66637 15.2136 0 23.2681 0 31.6667V48.3333C0 56.7319 2.66637 64.7864 7.41254 70.7251C12.1587 76.6637 18.5959 80 25.308 80H196.692C203.404 80 209.841 76.6637 214.587 70.7251C219.334 64.7864 222 56.7319 222 48.3333V31.6667C222 23.2681 219.334 15.2136 214.587 9.27495C209.841 3.3363 203.404 0 196.692 0V0ZM33.3 72.2222C26.5879 72.2222 20.1507 68.8859 15.4045 62.9473C10.6584 57.0086 7.992 48.9541 7.992 40.5556C7.992 32.157 10.6584 24.1025 15.4045 18.1638C20.1507 12.2252 26.5879 8.88889 33.3 8.88889H188.7C195.412 8.88889 201.849 12.2252 206.595 18.1638C211.342 24.1025 214.008 32.157 214.008 40.5556C214.008 48.9541 211.342 57.0086 206.595 62.9473C201.849 68.8859 195.412 72.2222 188.7 72.2222H33.3Z" fill="#3F3F3F"/>
                            </g>
                            <g id="LocationCircle" ref={LocationCirRef}>
                                <circle className="cls-2" cx="39.06" cy="40.5" r="20"/>
                                <path  className="cls-3" d="M45.31,40.81a29.64,29.64,0,0,1-2.94,4.6,47.05,47.05,0,0,1-3.31,3.86,43.46,43.46,0,0,1-3.31-3.86,28.23,28.23,0,0,1-2.94-4.6,10.32,10.32,0,0,1-1.25-4.41,7.5,7.5,0,0,1,15,0A10.46,10.46,0,0,1,45.31,40.81ZM39.06,51.4s9-8.53,9-15a9,9,0,1,0-18,0C30.06,42.87,39.06,51.4,39.06,51.4Z"/>
                                <path  className="cls-3" d="M39.06,39.4a3,3,0,0,1-2.13-.88,3,3,0,0,1,0-4.24,3,3,0,0,1,4.25,0,3,3,0,0,1,0,4.24A3,3,0,0,1,39.06,39.4Zm0,1.5a4.49,4.49,0,1,0-3.19-1.32,4.49,4.49,0,0,0,3.19,1.32Z"/>
                            </g>
                            <g id="descCircle" ref={DescriptionCirRef}>
                                <circle  className="cls-4" cx="87.06" cy="40.5" r="20"/>
                                <path  className="cls-3" d="M96.81,32.33a.77.77,0,0,1,.53.22.79.79,0,0,1,.22.53v13.5a.79.79,0,0,1-.22.54.76.76,0,0,1-.53.21H77.31a.74.74,0,0,1-.53-.21.79.79,0,0,1-.22-.54V33.08a.79.79,0,0,1,.22-.53.75.75,0,0,1,.53-.22Zm-19.5-1.5a2.25,2.25,0,0,0-2.25,2.25v13.5a2.24,2.24,0,0,0,2.25,2.25h19.5a2.26,2.26,0,0,0,1.59-.65,2.29,2.29,0,0,0,.66-1.6V33.08a2.25,2.25,0,0,0-2.25-2.25Z"/>
                                <path  className="cls-3" d="M79.56,36.08a.79.79,0,0,1,.22-.53.75.75,0,0,1,.53-.22h13.5a.77.77,0,0,1,.53.22.76.76,0,0,1,0,1.07.76.76,0,0,1-.53.21H80.31a.74.74,0,0,1-.53-.21A.79.79,0,0,1,79.56,36.08Zm0,3.75a.79.79,0,0,1,.22-.53.75.75,0,0,1,.53-.22h13.5a.77.77,0,0,1,.53.22.76.76,0,0,1,0,1.07.76.76,0,0,1-.53.21H80.31a.74.74,0,0,1-.53-.21A.79.79,0,0,1,79.56,39.83Zm0,3.75a.79.79,0,0,1,.22-.53.75.75,0,0,1,.53-.22h9a.77.77,0,0,1,.53.22.76.76,0,0,1,0,1.07.76.76,0,0,1-.53.21h-9a.74.74,0,0,1-.53-.21A.79.79,0,0,1,79.56,43.58Z"/>
                            </g>
                            <g id="ContactCircle" ref={ContactCirRef}>
                                <circle className="cls-5" cx="135.06" cy="39.83" r="20"/>
                                <path className="cls-3" d="M130.14,29.39a1,1,0,0,0-.33-.27,1,1,0,0,0-.41-.12.85.85,0,0,0-.42.07,1,1,0,0,0-.36.23l-1.55,1.55a2.56,2.56,0,0,0-.68,2.66,26.5,26.5,0,0,0,16.17,16.16,2.55,2.55,0,0,0,2.65-.68l1.55-1.55a1,1,0,0,0,.23-.36,1,1,0,0,0,.07-.42,1,1,0,0,0-.12-.41,1.09,1.09,0,0,0-.27-.33l-3.46-2.69a1.14,1.14,0,0,0-.42-.19,1,1,0,0,0-.45,0l-3.29.82a2.61,2.61,0,0,1-1.33,0,2.66,2.66,0,0,1-1.16-.67l-3.68-3.69a2.58,2.58,0,0,1-.67-1.15,2.61,2.61,0,0,1,0-1.33l.82-3.29a1,1,0,0,0,0-.45,1.07,1.07,0,0,0-.19-.42Zm-2.66-1.22a2.57,2.57,0,0,1,.93-.6,2.71,2.71,0,0,1,1.09-.17,2.81,2.81,0,0,1,1.06.3,2.74,2.74,0,0,1,.84.71l2.69,3.46a2.61,2.61,0,0,1,.48,2.24l-.82,3.29a.89.89,0,0,0,0,.51,1.07,1.07,0,0,0,.26.45l3.69,3.69a1.07,1.07,0,0,0,.45.26,1,1,0,0,0,.51,0l3.29-.82a2.71,2.71,0,0,1,1.17,0,2.57,2.57,0,0,1,1.07.5l3.46,2.69a2.61,2.61,0,0,1,.24,3.91l-1.55,1.55A4.17,4.17,0,0,1,142,51.18,28.11,28.11,0,0,1,124.88,34a4.17,4.17,0,0,1,1.05-4.31l1.56-1.55Z"/>
                            </g>
                            <g id="attendeesCircle" ref={AttendeeCirRef}>
                                <circle className="cls-6" cx="183.06" cy="39.83" r="20"/>
                                <path className="cls-3" d="M192.81,48.08a1.47,1.47,0,0,0,1.5-1.5c0-1.5-1.5-6-7.5-6s-7.5,4.5-7.5,6a1.47,1.47,0,0,0,1.5,1.5Zm-12-1.5h0A4.57,4.57,0,0,1,182,44a7.11,7.11,0,0,1,9.72,0,4.64,4.64,0,0,1,1.14,2.58h-12Zm6-9a3,3,0,0,0,2.12-.87,3,3,0,0,0-2.12-5.13,3,3,0,1,0,0,6Zm4.5-3A4.58,4.58,0,0,1,190,37.77a4.6,4.6,0,0,1-1.46,1,4.43,4.43,0,0,1-1.72.34,4.48,4.48,0,0,1-1.73-.34,4.6,4.6,0,0,1-1.46-1,4.77,4.77,0,0,1-1-1.46,4.45,4.45,0,0,1-.34-1.73,4.5,4.5,0,0,1,9,0ZM180.71,41a9.68,9.68,0,0,0-1.84-.37c-.36,0-.71-.05-1.06-.05-6,0-7.5,4.5-7.5,6a1.32,1.32,0,0,0,1.5,1.5h6.32a3.35,3.35,0,0,1-.32-1.5,6.86,6.86,0,0,1,1.63-4.35A8.73,8.73,0,0,1,180.71,41Zm-3,1.08a8.22,8.22,0,0,0-1.38,4.5h-4.5A4.54,4.54,0,0,1,173,44a5.89,5.89,0,0,1,4.74-1.91Zm-5.13-6.75a4.47,4.47,0,1,1,1.31,3.19,4.52,4.52,0,0,1-1.31-3.19Zm4.5-3a3,3,0,1,0,2.12,5.13,3,3,0,0,0-2.12-5.13Z"/>
                            </g>
                        </g>
                    </g>
                </svg>
                {toggledWindow}
            </div>
            <div className="Tail-Container">
                {HasTail && <Tail />}
            </div>
        </div>
    )
}

export default EventCircle

/*
<svg className="EventCircle-SVG-Container" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" viewBox="0 0 147.95 154.14">
                <defs>
                    <linearGradient id="linear-gradient" x1="20.57" y1="130.48" x2="127.38" y2="23.66" gradientUnits="userSpaceOnUse">
                        <stop offset="0.19" stopColor="#c0b6ed"/>
                        <stop offset="0.35" stopColor="#cfc5ed"/>
                        <stop offset="0.55" stopColor="#ddd2ee"/>
                        <stop offset="0.74" stopColor="#e1d6ee"/>
                    </linearGradient>
                </defs>
                <g id="Layer_2" data-name="Layer 2">
                    <g id="Layer_1-2" data-name="Layer 1">
                        <path style= {{fill:'url(#linear-gradient)'}} className="cls-1" d="M74,0C33.13,0,0,34.52,0,77.07s33.13,77.07,74,77.07,74-34.52,74-77.07S114.82,0,74,0Zm0,148.64c-37.93,0-68.69-32-68.69-71.57S36,5.5,74,5.5s68.7,32,68.7,71.57S111.91,148.64,74,148.64Z"/>
                        <g id="attendeesCircle" ref={AttendeeCirRef}>
                            <circle className="cls-2" cx="102.93" cy="104.14" r="20" style={{fill:"85a2e0"}}/>
                            <path className="cls-3" style={{fill:"3f3f3f"}} d="M113.13,113.11a1.47,1.47,0,0,0,1.5-1.5c0-1.5-1.5-6-7.5-6s-7.5,4.5-7.5,6a1.47,1.47,0,0,0,1.5,1.5Zm-12-1.5h0a4.57,4.57,0,0,1,1.14-2.58,7.11,7.11,0,0,1,9.72,0,4.57,4.57,0,0,1,1.14,2.58h-12Zm6-9A3,3,0,1,0,105,97.49a3,3,0,0,0,2.12,5.12Zm4.5-3a4.45,4.45,0,0,1-.34,1.73,4.63,4.63,0,0,1-1,1.46,4.51,4.51,0,0,1-3.18,1.31,4.43,4.43,0,0,1-1.72-.34,4.49,4.49,0,0,1-1.46-1,4.46,4.46,0,0,1-1.32-3.19,4.5,4.5,0,0,1,9,0ZM101,106a9.63,9.63,0,0,0-1.85-.37c-.35,0-.7,0-1.06,0-6,0-7.5,4.5-7.5,6a1.32,1.32,0,0,0,1.5,1.5h6.33a3.23,3.23,0,0,1-.33-1.5,6.88,6.88,0,0,1,1.64-4.35A8.25,8.25,0,0,1,101,106Zm-3,1.08a8.22,8.22,0,0,0-1.38,4.5h-4.5A4.62,4.62,0,0,1,93.27,109,5.92,5.92,0,0,1,98,107.12Zm-5.13-6.75a4.49,4.49,0,1,1,1.32,3.19,4.53,4.53,0,0,1-1.32-3.19Zm4.5-3a3,3,0,1,0,2.12.88A3,3,0,0,0,97.38,97.36Z"/>
                        </g>
                        <g id="descCircle" ref={DescriptionCirRef}>
                            <circle  className="cls-4" cx="102.93" cy="53.14" r="20" style={{fill:"E085A2"}}/>
                            <path className="cls-3" style={{fill:"3f3f3f"}} d="M112.38,45.61a.75.75,0,0,1,.53.22.79.79,0,0,1,.22.53v13.5a.79.79,0,0,1-.22.54.74.74,0,0,1-.53.21H92.88a.74.74,0,0,1-.53-.21.79.79,0,0,1-.22-.54V46.36a.79.79,0,0,1,.22-.53.75.75,0,0,1,.53-.22Zm-19.5-1.5a2.25,2.25,0,0,0-1.59.66,2.28,2.28,0,0,0-.66,1.59v13.5a2.29,2.29,0,0,0,.66,1.6,2.24,2.24,0,0,0,1.59.65h19.5a2.24,2.24,0,0,0,1.59-.65,2.29,2.29,0,0,0,.66-1.6V46.36a2.28,2.28,0,0,0-.66-1.59,2.25,2.25,0,0,0-1.59-.66Z"/>
                            <path className="cls-3" style={{fill:"3f3f3f"}} d="M95.13,49.36a.79.79,0,0,1,.22-.53.75.75,0,0,1,.53-.22h13.5a.75.75,0,0,1,.53.22.76.76,0,0,1,0,1.07.74.74,0,0,1-.53.21H95.88a.74.74,0,0,1-.53-.21A.79.79,0,0,1,95.13,49.36Zm0,3.75a.79.79,0,0,1,.22-.53.75.75,0,0,1,.53-.22h13.5a.75.75,0,0,1,.53.22.76.76,0,0,1,0,1.07.74.74,0,0,1-.53.21H95.88a.74.74,0,0,1-.53-.21A.79.79,0,0,1,95.13,53.11Zm0,3.75a.79.79,0,0,1,.22-.53.75.75,0,0,1,.53-.22h9a.75.75,0,0,1,.53.22.76.76,0,0,1,0,1.07.74.74,0,0,1-.53.21h-9a.74.74,0,0,1-.53-.21A.79.79,0,0,1,95.13,56.86Z"/>
                        </g>
                        <g id="LocationCircle" ref={LocationCirRef}>
                            <circle className="cls-5" cx="45.93" cy="54.14" r="20" style={{fill:"D0E085"}}/>
                            <path className="cls-3" style={{fill:"3f3f3f"}} d="M51.88,55.52a29,29,0,0,1-2.94,4.61A46.64,46.64,0,0,1,45.63,64a48.63,48.63,0,0,1-3.31-3.85,29,29,0,0,1-2.94-4.61,10.38,10.38,0,0,1-1.25-4.41,7.5,7.5,0,0,1,15,0A10.38,10.38,0,0,1,51.88,55.52ZM45.63,66.11s9-8.52,9-15a9,9,0,0,0-18,0C36.63,57.59,45.63,66.11,45.63,66.11Z"/>
                            <path className="cls-3" style={{fill:"3f3f3f"}} d="M45.63,54.11a3,3,0,0,1-2.12-.87,3,3,0,0,1,2.12-5.13,3,3,0,1,1,0,6Zm0,1.5a4.5,4.5,0,1,0-4.5-4.5,4.49,4.49,0,0,0,4.5,4.5Z"/>
                        </g>
                        <g id="ContactCircle" ref={ContactCirRef}>
                            <circle className="cls-6" cx="45.93" cy="104.14" r="20" style={{fill:"85E0C3"}}/>
                            <path className="cls-3" d="M39.1,94.36a1.09,1.09,0,0,0-.33-.27,1,1,0,0,0-.41-.12,1,1,0,0,0-.42.07,1,1,0,0,0-.36.23L36,95.82a2.57,2.57,0,0,0-.68,2.66,26.5,26.5,0,0,0,16.17,16.16,2.57,2.57,0,0,0,2.65-.67l1.55-1.56a1,1,0,0,0,.23-.35,1.05,1.05,0,0,0,.07-.43,1,1,0,0,0-.12-.41,1.09,1.09,0,0,0-.27-.33l-3.46-2.69a1.14,1.14,0,0,0-.42-.19,1,1,0,0,0-.45,0l-3.29.82a2.61,2.61,0,0,1-1.33,0,2.58,2.58,0,0,1-1.15-.67l-3.69-3.69a2.52,2.52,0,0,1-.67-1.15,2.61,2.61,0,0,1,0-1.33L42,98.69a1,1,0,0,0,0-.45,1,1,0,0,0-.19-.42Zm-2.66-1.22a2.7,2.7,0,0,1,.93-.6,2.54,2.54,0,0,1,1.09-.16,2.55,2.55,0,0,1,1.9,1l2.69,3.46a2.62,2.62,0,0,1,.48,2.24l-.82,3.29a1,1,0,0,0,0,.51,1.07,1.07,0,0,0,.26.45L46.66,107a1.07,1.07,0,0,0,.45.26.89.89,0,0,0,.51,0l3.29-.82a2.71,2.71,0,0,1,1.17,0,2.51,2.51,0,0,1,1.07.5l3.46,2.69a2.61,2.61,0,0,1,.24,3.91L55.3,115.1A4.17,4.17,0,0,1,51,116.15,28.11,28.11,0,0,1,33.84,99a4.17,4.17,0,0,1,1.06-4.31l1.55-1.55Z"
                                style={{fill:"3f3f3f"}}
                            />
                        </g>
                    </g>
                </g>
            </svg>
            {toggleW}
            {toggleContact}
            {toggleLocation}
            {toggleDescription}
*/